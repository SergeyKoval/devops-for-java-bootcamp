#cloud-config
repo_update: true
repo_upgrade: all
packages:
- httpd
- php
runcmd:
- [ chown, "ec2-user:ec2-user", "/home/ec2-user/.ssh/instance2_id_rsa" ]
- systemctl start httpd
- sudo systemctl enable httpd
- [ sh, -c, "usermod -a -G apache ec2-user" ]
- [ sh, -c, "chown -R ec2-user:apache /var/www" ]
- chmod 2775 /var/www
- [ find, /var/www, -type, d, -exec, chmod, 2775, {}, \; ]
- [ find, /var/www, -type, f, -exec, chmod, 0664, {}, \; ]
write_files:
- path: /home/ec2-user/.ssh/instance2_id_rsa
  encoding: b64
  permissions: '0600'
  content: LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQ21GbGN6STFOaTFqZEhJQUFBQUdZbU55ZVhCMEFBQUFHQUFBQUJCYUs2V1lINwpOK0tKWU5qaHBvTndhS0FBQUFFQUFBQUFFQUFBR1hBQUFBQjNOemFDMXljMkVBQUFBREFRQUJBQUFCZ1FEV0VrN0s3cm5nCnp6dXNSMVZrRXZRNUs2N3MwTGt4Z1NFWWFWNHg0dnFrNC84MVVFOE4zVzY0YS92MTI0cTYxZmhUNjQ3azY4TXYrRjJFVm4KZDg3ejRST0srb1Jzam1HREZJSkFBR3h1V1Z3NFhkWUZPLzF4ZFgvWnQ5dmpTMXhuSmhQT3duQ21iUGVZUkhqdFMxbVlkQQppTzZ5RG1IbXBLM3h2c0c3OUFPeDlmOWptazRVMDR2Ukh3UUVrVXNoanFhRkU2QkV6QktjV2xuZG50ZWQrVytBRHZOWlRGClZldzEyZmdQQnBnTU9GQUVZcWZheWJ3YUJ6NzYrcXA4bEJ5RkYxdmkxSG5Yalo4dFdWelVGdmUyL2l5UkZlL2tIRVJGNmIKTDdjbDNqamFpcG94enlHbzZ1SUsva1E0VEYyRnhNemUzc2IvcElsTi9kSDZieS9sMkErTVVwWWFlVW90bE1LbHJlWjFqaApGMnRVNWI5K2JBV1hXOE9CTmtqKzR6YUVFM0lhdFJWV2NpVkl5anU3bVNDckR6dHhNV08reHh3cjRKUW42a3B5dVpYdUlpCllraXZ6WXdvTjlwL2R1bTA0aWp2YzhBRnJGY1ZyZnNjcFl2YU5ldVBtQko0TVVHdEVycHBEeUZaVkduVld4OGNlcmhYSkMKQWdFV3VncjZ5dWVuY0FBQVdnRCtJdkN6OUNtNDFWY1dEejBMd1p6UHk0N1lFeDViUTdnVFFLRHRydXczWFZiYkplZk1PMAp1TVBmNGNyR0ZZViszY1d2Y3Y3NnpkOG1GUnlNckJZMWpiemdRNzltQ3grY2loekhUeTAvMzdqZ3poNElyelNLN2JBUzR2CjVjUGxlOGlkaDN1U1JUdG03ZHlkbnh6NnBWQi9QY2tEbDBYNjZZQ1ZvNUd3KzFEcnM1aW9tQlJmOW0zeUwyV3RrUDFVa3YKa3hCMk1NcG5lVHJwK0RNdTR4eDYwMVNpa0podlIvd20vaDBpY0RERk0ydHcvU1hxNzJoZUNrUVFCR1BrdFdmOXZWMnR1KwpVV3ExajN3ZHJPLzkrcTBFLzRScE1rdjlLRkszOWtCbFpKNVdzUE5Pck1hS0JnOEt5WFVZL3oyazk5TC8xSFVXRThLOGR2CjV3dWxUZVdPZi94MHJRQnVkUGdHa3NaSWI4MEVNRVpFbG1DZXRvWXhnZkRYaWpiNlZBeTAwR1lURCtNalBQZFBOMERyVzMKbnRWcDdueFZDcFFmMW5vVDBQZjliaWx2M0VoaWFZRzdJcGk5MTB0WjZTa2FiS2NUMi80eThIQzdvc3c0NEJCSEJvNG50eApzdXh0dWNldDJ1RVRxZ1RHYTNyZ0p6dllaZHc0Y0ZtR1o1eXJnZmN3YW1zdnluUWEwbHhIQ1R2emNoY3BKQ2lQTlNTYzBkCkF0ZlJQbUJVVU40S21CbU9oWU9rNEwvV3NzSThmam45SWxmNTYzTWNUZ29FWFZnUkpmRkJSNmhtK2tNSWtrUmRXUzFWYloKQjBDUjJjVDZCVmhDbUxoU1VPWm5Kb1FwbGE5K21FSnFTY0Q0eXozekNHeHpkMHczUHZydmxyeUpBREdFMU42RFpWOGRiRwpLNlY4N0tGaXBSZmNDRldDSE1PV0h4azdncjhuSjhlbk1QcC84cllzZUJBZ1JGZVJWUndzTnVYeVRicXorWGdVb2s4ZU05CmE3SXJmREZDb0kxNSthLzVHTWFDSmJ6UXIzQ01PUTN3QzA3SzlnSHkvc1ZwZTA0cHFSRmZIQVUwWVdKVWdzcUNoSE5KdXkKaitKbmtlaXpTMnBkWE1LNyt5cFZIandxd202VmNMUGo4WHdTWHZ4OHpPa1hhejNPVFBrcDRoK0ZBSWdLakhmdHl2dEhZYwpmWUJ1MHUzNXAzdi9pYW9weWdNOFltbTMvYS9hcm51M3gvNmhsN1dRRFIwS3ZFME9FczhxeGI0eE0xcUg0WE9hRmsySFd5ClRDaVFxOGJpQlpCVmJrZlBEcGEybmRveDF6eUl6bDV4KzFaTWZHSDdaby9Va2FGaElJQ2h0WE5WVGRJWHdaQjU3bEVicVYKR09ocEZ0bEtHSVBGMVVBQ0pGc09rckw1VFZhYUdFMzlGYnJDYnFuYnRHN3BPbU1xUms4VURwbkFZM2lSdFZkdkNEd3RQeAp6UGFDaXFYb052NHJqeHJ1Y2V6dkxzWnBRd0lRVmpGcnpKRFNNN3pNQmpXNHVLNUZRRVZRNm5OSkgyWjBKaE8rTGxVUGg2CmVuQ0h1aDM3Y0JUQ0p2M2xRMTJ4eUlhNW91R2FMQlZoeTNucTBSWENLQUxQSmRXVEZBa2x3RlNZckgzb255TUE4WmNSbmkKbVRiUmJxQzY5NWNXbWlNOGNvZHlnaFQzZ2RleWl1VGxOdS9lbmtQbHc0Q0Y2WjFjU2tXbHlSQWkwWHFpTWlBcW1WdE1tZgo0eHpHbHIwaXNGWmsxU0YzRW5JM0hnZzZVVHBETzBpR0hBS01pMVZzdVI1UWwwVzJYRlZ3VGU1Si9QVGJSd0xJWExqRTZsCnZPQTU3QVg1L0RBUzFlSHhBblg0WEZBR1JQYUhJNzdxMzFpWndMMk5JSm9GSVpPOUFOc3hWazFLYVQwWFM0eldMZTJiTVQKbE1vTzhKZTZuSVFyZmxKbWl0cGp5THNadjVHODkrRWI1ZXhmRjg4Q1JiT0hPdkZxc0NVcGovd1N3OXFUcy80SzJZbEhwcwp6SitmQmVCVWNpWEZqMmtMTjBmckpWbkhhUm1oczd4QWFFc0JnaTJMbDlMQ1JaRGpKdXVyVVZ2NEVXMGlBNUdlUEVGbWovCi9uVGhNaUdLbjFEcC83TWxpS2luN2ZVakJnVVlWc01uNlNiY2lYSDhXdCsrVFA5azhPeEx0WkxWalVPWjJQZTh5QjdGdWgKT1E3dXd5VU5UakxLUlVCc1k4UWs0QTZpQ1g3ZzJxeWZIWEc0TlllVGVrNE1QNkVsOXlUcFpISThEc0Q2UFdzZVp6N3JzNwo3T0ZnbTVLaTg2YVpMYkg4eXhXRTNvcHM2MDM3MW11OUxWNjRVdzRINy9zbHBDc24zZWpCbllQbTRBcE1nS2IrajY1QVZKClJvNXg1ZU9MZjZZQVdnZ0FweE8vYktSd1Y2SmhCbzlEMVdZbXFrNHl2TDVnanhrdWtxT3A3cHJoOURjcjYvS3FqNlFNY1EKWDJxeWlpcGN0QjE1cjk2NjZPT2Z1SmpGTkpnT016L2I0MGFUWDRLZWd3Y0x1UFFZCi0tLS0tRU5EIE9QRU5TU0ggUFJJVkFURSBLRVktLS0tLQo=
- path: /var/www/html/info.php
  encoding: b64
  permissions: '0664'
  content: PD9waHAKZnVuY3Rpb24gZ2V0T1NJbmZvcm1hdGlvbigpCiAgICB7CiAgICAgICAgaWYgKGZhbHNlID09IGZ1bmN0aW9uX2V4aXN0cygic2hlbGxfZXhlYyIpIHx8IGZhbHNlID09IGlzX3JlYWRhYmxlKCIvZXRjL29zLXJlbGVhc2UiKSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgICRvcyAgICAgICAgID0gc2hlbGxfZXhlYygnY2F0IC9ldGMvb3MtcmVsZWFzZScpOwogICAgICAgICRsaXN0SWRzICAgID0gcHJlZ19tYXRjaF9hbGwoJy8uKj0vJywgJG9zLCAkbWF0Y2hMaXN0SWRzKTsKICAgICAgICAkbGlzdElkcyAgICA9ICRtYXRjaExpc3RJZHNbMF07CgogICAgICAgICRsaXN0VmFsICAgID0gcHJlZ19tYXRjaF9hbGwoJy89LiovJywgJG9zLCAkbWF0Y2hMaXN0VmFsKTsKICAgICAgICAkbGlzdFZhbCAgICA9ICRtYXRjaExpc3RWYWxbMF07CgogICAgICAgIGFycmF5X3dhbGsoJGxpc3RJZHMsIGZ1bmN0aW9uKCYkdiwgJGspewogICAgICAgICAgICAkdiA9IHN0cnRvbG93ZXIoc3RyX3JlcGxhY2UoJz0nLCAnJywgJHYpKTsKICAgICAgICB9KTsKCiAgICAgICAgYXJyYXlfd2FsaygkbGlzdFZhbCwgZnVuY3Rpb24oJiR2LCAkayl7CiAgICAgICAgICAgICR2ID0gcHJlZ19yZXBsYWNlKCcvPXwiLycsICcnLCAkdik7CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBhcnJheV9jb21iaW5lKCRsaXN0SWRzLCAkbGlzdFZhbCk7CiAgICB9CgpmdW5jdGlvbiBnZXRTeXN0ZW1NZW1JbmZvKCkKewogICAgJGRhdGEgPSBleHBsb2RlKCJcbiIsIGZpbGVfZ2V0X2NvbnRlbnRzKCIvcHJvYy9tZW1pbmZvIikpOwogICAgJG1lbWluZm8gPSBhcnJheSgpOwogICAgZm9yZWFjaCAoJGRhdGEgYXMgJGxpbmUpIHsKICAgICAgICBsaXN0KCRrZXksICR2YWwpID0gZXhwbG9kZSgiOiIsICRsaW5lKTsKICAgICAgICAkbWVtaW5mb1ska2V5XSA9IHRyaW0oJHZhbCk7CiAgICB9CiAgICByZXR1cm4gJG1lbWluZm87Cn0KCiRtZW1faW5mbyA9IGdldFN5c3RlbU1lbUluZm8oKTsKJG9zX2luZm8gPSBnZXRPU0luZm9ybWF0aW9uKCk7CiRieXRlcyA9IGRpc2tfZnJlZV9zcGFjZSgiLyIpOwokc2lfcHJlZml4ID0gYXJyYXkoICdCJywgJ0tCJywgJ01CJywgJ0dCJywgJ1RCJywgJ0VCJywgJ1pCJywgJ1lCJyApOwokYmFzZSA9IDEwMjQ7CiRjbGFzcyA9IG1pbigoaW50KWxvZygkYnl0ZXMgLCAkYmFzZSkgLCBjb3VudCgkc2lfcHJlZml4KSAtIDEpOwoKcHJpbnRfcigiPGRpdj5IZWxsbyB3b3JsZCBmb3IgdGFzayAxPC9kaXY+Iik7CgpwcmludF9yKCI8ZGl2PkZyZWUgZGlzayBzcGFjZTogIi5zcHJpbnRmKCclMS4yZicgLCAkYnl0ZXMgLyBwb3coJGJhc2UsJGNsYXNzKSkgLiAnICcgLiAkc2lfcHJlZml4WyRjbGFzc10uIjwvZGl2PiIpOwpwcmludF9yKCI8ZGl2PlNlcnZlciBPUzogIi4kb3NfaW5mb1sncHJldHR5X25hbWUnXS4iPC9kaXY+Iik7CnByaW50X3IoIjxkaXY+VG90YWwgbWVtb3J5OiAiLiRtZW1faW5mb1snTWVtVG90YWwnXS4iPC9kaXY+Iik7CnByaW50X3IoIjxkaXY+RnJlZSBtZW1vcnk6ICIuJG1lbV9pbmZvWydNZW1GcmVlJ10uIjwvZGl2PjwvYnI+PC9icj48L2JyPiIpOwoKcHJpbnRfcigiPGRpdj5SdW5uaW5nIHByb2Nlc3Nlczo8L2Rpdj4iKTsKJGV4ZWNzdHJpbmc9J3BzIGZhdXgnOwokb3V0cHV0PSIiOwpleGVjKCRleGVjc3RyaW5nLCAkb3V0cHV0KTsKZm9yZWFjaCgkb3V0cHV0IGFzICRvdXRwdXRfaXRlbSkgewogIHByaW50X3IoIjxkaXY+Ii4kb3V0cHV0X2l0ZW0uIjwvZGl2PiIpOwp9Cj8+Cg==
ssh_authorized_keys:
  - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDH4ndLz8Jsqg1COiTjiM6yuOwCLC2MQYn8OzTmKn9l5A/DqraLfOo66rFAHKTrdMl1NntHDoE9jh1h0LYF/Eqvv96K4mSbuIzazijY3Njeta08YfAVWcnHPWhmyULH1i3V4iENseHFmXHbYHksIf4mJo4SoH3QI15yyOaEOvtY+/sL9uOHv6Eavx6GPbjMRwe55P2hmNMNG65q5j4j6nPbYrc5LmgkINRLNrrsFXYHgRz2c0jXrTw1UrSuabiNKvf22QbMEP/vEh23tSwJ244Z7+cHAGyThqsn4QnuG02iPcR8/8GUrkpSNAHVsjjIpZmrAucf9CbrtGXdt6u0dJcs2gNEf+dC8iYVbS7uyddMewq+J9JSpNMCmkPhFOf38n0EpiewaPNTrL7W0Zj17C2aCjX8uYvXnmpcXgx5o357gfGhpcGHcZe3v+E2raVuPGE5J/+AIsr5cb6mKqv8Jo4dAVftxXvjAuPBlW6C2JbvBgvfLfqjV8nBy2VFibB6o+U= ubuntu-instance-key
